<html>
<head>
<script>
var status;

function setStatus(value)
{
	status = value;
	if(status == 1)
	{
		chrome.browserAction.setBadgeText({text:"ON"});	
		chrome.browserAction.setBadgeBackgroundColor({color:[103,163,82,255]});
	}
	else
	{
		chrome.browserAction.setBadgeText({text:"OFF"});	
		chrome.browserAction.setBadgeBackgroundColor({color:[185,188,193,255]});		
	}
}

function initStatus(){
	if(typeof(localStorage['glee_status']) != "undefined")
	{
		setStatus(localStorage['glee_status']);
	}
	else
		setStatus(1);
}

function toggleStatus(tab){
	if(typeof(localStorage['glee_status']) != "undefined")
	{
		status = localStorage['glee_status'];
	}
	else
		status = 1;
	if(status == 1)
		setStatus(0);
	else
		setStatus(1);
	localStorage['glee_status'] = status;
	
	chrome.tabs.sendRequest(tab.id, {status:status},function(response){
	});
	
}

//React when a browser action's icon is clicked 
chrome.browserAction.onClicked.addListener(function(tab) {
	toggleStatus(tab);
});

chrome.extension.onRequest.addListener(function(request,sender,sendResponse){
	if(request.value == "getStatus")
	{
		sendResponse({status:(status?1:0)});
	}
	else if(request.value == "createTab")
	{
		chrome.tabs.create({url:request.url},null);
		sendResponse({});
	}
	else if(request.value == "sendRequest")
	{
		var req = new XMLHttpRequest();
		req.open(request.method,request.url, true);
		req.onreadystatechange = function(){
			if(req.readyState == 4)
			{
				sendResponse({data:req.responseText});
			}
		}
		req.send();
	}
});

</script>
</head>
<body onload="initStatus();">
</body>
</html>